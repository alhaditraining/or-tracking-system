@using Microsoft.AspNetCore.Components
@inject NavigationManager Nav

<MudNavMenu>

    <AuthorizeView Policy="ViewerOrAdmin">
        <Authorized>
            <MudNavGroup Title="Reports" Icon="@Icons.Material.Filled.Assessment" Expanded="true">
                <MudNavLink Href="/reports/dashboard" Icon="@Icons.Material.Filled.Dashboard" OnClick="NotifyClicked">Dashboard</MudNavLink>
                <MudNavLink Href="/reports/ors" Icon="@Icons.Material.Filled.AccountBalance" OnClick="NotifyClicked">OR Reports</MudNavLink>
                <MudNavLink Href="/reports/invoices" Icon="@Icons.Material.Filled.Receipt" OnClick="NotifyClicked">Invoice Reports</MudNavLink>
                <MudNavLink Href="/reports/stationery" Icon="@Icons.Material.Filled.Edit" OnClick="NotifyClicked">Stationery Reports</MudNavLink>
            </MudNavGroup>
        </Authorized>
    </AuthorizeView>

    <AuthorizeView Policy="AdminOnly">
        <Authorized>
            <MudDivider Class="my-2" />
            <MudNavGroup Title="Administration" Icon="@Icons.Material.Filled.AdminPanelSettings" Expanded="true">
                <MudNavLink Href="/admin/users" Icon="@Icons.Material.Filled.People" OnClick="NotifyClicked">User Management</MudNavLink>
                <MudNavLink Href="/admin/contract-contexts" Icon="@Icons.Material.Filled.Description" OnClick="NotifyClicked">Contract Contexts</MudNavLink>
                <MudNavLink Href="/admin/ors" Icon="@Icons.Material.Filled.AccountBalance" OnClick="NotifyClicked">ORs</MudNavLink>
                <MudNavLink Href="/admin/invoices" Icon="@Icons.Material.Filled.AccountBalance" OnClick="NotifyClicked">Invoicess</MudNavLink>
                <MudNavLink Href="/admin/stationery" Icon="@Icons.Material.Filled.AccountBalance" OnClick="NotifyClicked">stationery</MudNavLink>
                <MudNavLink Href="/admin/requests" Icon="@Icons.Material.Filled.Assignment" OnClick="NotifyClicked">LM Requests</MudNavLink>
            </MudNavGroup>
        </Authorized>
    </AuthorizeView>

    <AuthorizeView>
        <Authorized>
            <MudDivider Class="my-2" />

            <!-- Account SSR -->
            <MudNavLink OnClick="GoAccount" Icon="@Icons.Material.Filled.Person">
                Account
            </MudNavLink>

            <!-- ✅ Logout endpoint MUST be ForceLoad -->
            <MudNavLink Href="/logout" ForceLoad="true" Icon="@Icons.Material.Filled.Logout" OnClick="NotifyClicked">
                Logout
            </MudNavLink>
        </Authorized>

        <NotAuthorized>
            <MudDivider Class="my-2" />

            <!-- ✅ Login endpoint MUST be ForceLoad -->
            <MudNavLink Href="/login" ForceLoad="true" Icon="@Icons.Material.Filled.Login" OnClick="NotifyClicked">
                Login
            </MudNavLink>
        </NotAuthorized>
    </AuthorizeView>

</MudNavMenu>

@code {
    [Parameter] public EventCallback AnyItemClicked { get; set; }
    private Task NotifyClicked() => AnyItemClicked.InvokeAsync();

    private async Task GoAccount()
    {
        await AnyItemClicked.InvokeAsync();
        Nav.NavigateTo("/Account/Manage", forceLoad: true);
    }
}
